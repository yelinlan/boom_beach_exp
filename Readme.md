### 项目概述
该项目旨在通过抓取和解析《海岛奇兵》游戏的数据，计算每个建筑的升级收益，并输出最优升级路线。数据来源为[海岛奇兵数据网站](https://bb.heiyu100.cn/shuju.aspx)。项目的主要功能包括数据抓取、解析、存储和计算。

### 主要功能

#### 数据抓取与存储
1. **数据抓取**：
    - 项目从[海岛奇兵数据网站](https://bb.heiyu100.cn/shuju.aspx)抓取所有以`shuju192`开头的网址。
    - 抓取的数据保存到本地的`text`文件夹中，以避免频繁抓取。

2. **数据解析**：
    - 如果本地`text`文件夹中没有数据，则从网络抓取数据并保存到`text`文件夹中。
    - 如果本地`text`文件夹中已有数据，则直接从本地读取数据。
    - 解析`text`文件夹中的所有表格文本，生成JSON数据并存储到`unitMap.txt`文件中。

3. **数据存储**：
    - 生成的JSON数据存储到`unitMap.txt`文件中，以避免重复解析。
    - 如果`unitMap.txt`文件已存在，则直接从文件中读取数据，不再重新解析。

#### 配置管理
1. **配置文件**：
    - 玩家配置信息存储在`config.txt`文件中。
    - 配置文件包括建筑配置、研究配置和其他配置信息。

2. **配置保存与加载**：
    - 如果`config.txt`文件不存在，则根据游戏数据生成配置模板并保存。
    - 如果`config.txt`文件已存在，则从文件中加载配置信息。

#### 升级计算与输出
1. **数据初始化**：
    - 从`unitMap.txt`文件中加载游戏数据。
    - 根据加载的数据初始化`GameData`对象，分类存储研究数据和建筑数据。

2. **升级计算**：
    - 根据当前游戏等级和配置信息，计算每个建筑的升级收益。
    - 计算每个建筑从当前等级升级到最大等级所需的总经验、总时间和收益比（经验/时间）。

3. **结果排序与输出**：
    - 对计算结果按照收益比进行降序排序。
    - 计算累计经验和总时间，输出每个建筑的升级路线、耗时、性价比和经验信息。
    - 根据累计经验判断玩家是否升级，并输出相关信息。

### 执行流程

1. **数据加载与解析**：
    - 检查`unitMap.txt`文件是否存在。
    - 如果文件不存在，则从网络抓取数据并保存到`text`文件夹中。
    - 解析`text`文件夹中的所有表格文本，生成JSON数据并存储到`unitMap.txt`文件中。
    - 如果文件存在，则直接从`unitMap.txt`文件中读取数据。

2. **配置加载**：
    - 检查`config.txt`文件是否存在。
    - 如果文件不存在，则根据游戏数据生成配置模板并保存。
    - 如果文件存在，则从`config.txt`文件中加载配置信息。

3. **数据初始化**：
    - 从`unitMap.txt`文件中加载游戏数据。
    - 根据加载的数据初始化`GameData`对象，分类存储研究数据和建筑数据。

4. **升级计算**：
    - 根据当前游戏等级和配置信息，计算每个建筑的升级收益。
    - 计算每个建筑从当前等级升级到最大等级所需的总经验、总时间和收益比（经验/时间）。

5. **结果排序与输出**：
    - 对计算结果按照收益比进行降序排序。
    - 计算累计经验和总时间，输出每个建筑的升级路线、耗时、性价比和经验信息。
    - 根据累计经验判断玩家是否升级，并输出相关信息。

### 总结
通过上述步骤，项目能够有效地抓取和解析《海岛奇兵》游戏的数据，计算每个建筑的升级收益，并输出最优升级路线。具体流程包括数据抓取、解析、存储和计算，确保数据的高效管理和计算的准确性。

### 1. 代码解释
项目的主要目的是通过加载和解析游戏数据，计算每个建筑的升级收益，并根据收益比进行排序，最终输出排序后的结果。主要类包括`Result`、`DataUtil`、`Config`、`GameData`、`DataDeal`和`Main`。

### 2. 主要类功能

#### `Result.java`
- **功能**：用于存储每个建筑升级的结果。
- **属性**：
    - `name`：建筑名称。
    - `level`：当前等级。
    - `exp`：升级所需经验。
    - `ratio`：收益比（经验/时间）。
    - `sum`：累计经验。
    - `currentMaxLevel`：最大等级。
    - `time`：单次升级时间。
    - `totalTime`：总时间。
- **方法**：
    - `toString`：格式化输出结果。

#### `DataUtil.java`
- **功能**：提供数据加载、解析和存储功能。
- **方法**：
    - `loadData`：
        - 检查文件是否存在，如果不存在则调用`fetchData`方法从网络获取数据。
        - 如果文件存在，则从文件中读取已保存的数据并解析为`Map`对象返回。
    - `fetchData`：
        - 从网络获取数据并解析成嵌套的映射结构。
        - 存储到文件中。
    - `getResult`：
        - 发送HTTP GET请求获取网页内容。
    - `toText`：
        - 将获取的数据转换为文本信息并存储在映射中。
    - `getAllShuJu`：
        - 解析每个结果的HTML内容，提取所需数据。
    - `getAllResult`：
        - 通过调用多个数据接口获取数据，合并后返回。
    - `getDataUrlSuffix`：
        - 获取数据页面的URL后缀集合。

#### `Config.java`
- **功能**：用于存储游戏配置信息，包括建筑、研究和其他配置。
- **属性**：
    - `buildings`：建筑配置。
    - `research`：研究配置。
    - `other`：其他配置。
- **方法**：
    - `saveTemplate`：
        - 保存配置模板。
    - `loadConfig`：
        - 从文件中加载配置信息。

#### `GameData.java`
- **功能**：存储游戏数据，包括研究数据、建筑数据、等级数据、数量数据、玩家数据和配置信息。
- **属性**：
    - `researchMap`：研究数据。
    - `buildingMap`：建筑数据。
    - `level`：等级数据。
    - `amount`：数量数据。
    - `player1`：玩家数据。
    - `config`：配置信息。

#### `DataDeal.java`
- **功能**：初始化游戏数据，将加载的数据分类存储到`GameData`对象中。
- **方法**：
    - `init`：
        - 根据数据内容将数据分类存储到`researchMap`和`buildingMap`中。
        - 处理等级和数量数据。
        - 保存和加载配置。

#### `Main.java`
- **功能**：主程序入口，负责加载游戏数据，处理和计算每个建筑的升级收益，并输出排序后的结果。
- **方法**：
    - `main`：
        - 初始化游戏数据。
        - 遍历每个建筑，计算每个建筑的升级收益。
        - 对结果列表按照收益比降序排序。
        - 输出结果。
    - `parseTimeToHours`：
        - 解析时间字符串为小时数。

### 3. 代码执行流程

#### 3.1 数据加载和解析
1. **加载数据**：
    - `DataUtil.loadData()`：
        - 检查文件`unitMap.txt`是否存在。
        - 如果文件不存在，调用`fetchData()`从网络获取数据并存储到文件中。
        - 如果文件存在，从文件中读取已保存的数据并解析为`Map`对象返回。
    - `DataUtil.fetchData()`：
        - 从网络获取数据并解析成嵌套的映射结构。
        - 存储到文件中。
        - 具体步骤：
            - 初始化一个有序的映射`unitMap`，用于存储最终的数据结构。
            - 从文本源解析数据，并将其组织成一个嵌套的映射结构。
            - 将解析后的数据存储到`unitMap`中。
            - 将最终的数据结构以JSON格式写入文件`unitMap.txt`。

2. **解析数据**：
    - `DataUtil.toText()`：
        - 将获取的数据转换为文本信息并存储在映射中。
        - 具体步骤：
            - 创建一个映射`dataMap`，用于存储转换后的数据。
            - 获取所有数据并逐个处理。
            - 解析HTML字符串，提取并处理标题信息。
            - 获取所有所需的数据元素，筛选出包含"宝石秒花费"的数据项。
            - 如果找到一个符合条件的数据项，尝试寻找包含"研究时间"的数据项。
            - 根据找到的数据项，将标题和研究时间或宝石秒花费添加到映射中。
            - 寻找包含特定关键字的数据项，可能是建筑物的最大等级或最大数量。
            - 如果找到了相关数据项，将数据添加到映射中。
    - `DataUtil.getAllShuJu()`：
        - 解析每个结果的HTML内容，提取所需数据。
        - 具体步骤：
            - 通过流处理，将每个数据接口的后缀转换为完整的URL，并获取数据。
            - 使用Jsoup库解析每个结果的HTML内容，提取类名为"shujuxx"的元素的HTML内容。
    - `DataUtil.getAllResult()`：
        - 通过调用多个数据接口获取数据，合并后返回。
        - 具体步骤：
            - 通过流处理，将每个数据接口的后缀转换为完整的URL，并获取数据。
    - `DataUtil.getDataUrlSuffix()`：
        - 获取数据页面的URL后缀集合。
        - 具体步骤：
            - 从指定的URL获取HTML内容。
            - 解析HTML内容为Document对象。
            - 遍历所有元素，获取所有属性值以"shuju"开头且以"html"结尾的属性，将其视为目标URL后缀并收集起来。

#### 3.2 初始化游戏数据
1. **初始化游戏数据**：
    - `DataDeal.init(unitMap)`：
        - 根据数据内容将数据分类存储到`researchMap`和`buildingMap`中。
        - 处理等级和数量数据。
        - 保存和加载配置。
        - 具体步骤：
            - 遍历`unitMap`，根据数据内容将数据分类存储到`researchMap`和`buildingMap`中。
            - 处理等级和数量数据，将`司令部_level`和`司令部_amount`数据添加到`gameData`中。
            - 保存配置模板。
            - 加载配置。

#### 3.3 计算升级收益
1. **计算升级收益**：
    - `Main.main()`：
        - 初始化游戏数据。
        - 遍历每个建筑，计算每个建筑的升级收益。
        - 对结果列表按照收益比降序排序。
        - 输出结果。
        - 具体步骤：
            - 初始化游戏数据。
            - 创建一个列表`list`用于存储计算结果。
            - 获取游戏等级配置。
            - 遍历每个建筑，计算每个建筑的升级收益。
                - 获取当前建筑的数据映射`bu`。
                - 获取当前建筑在当前等级的数量`num`。
                - 创建一个计数器`count`，用于记录当前建筑的处理数量。
                - 获取当前建筑在当前等级的最大等级`currentMaxLevel`。
                - 分割建筑配置字符串，并遍历每个配置。
                - 从当前等级升级到最大等级。
                - 获取升级所需经验和时间。
                - 创建一个结果对象`result`，存储计算结果。
                - 将结果对象添加到`finalList`中。
            - 对结果列表按照收益比降序排序。
            - 计算累计经验和总时间。
            - 输出结果。
            - 根据累计经验判断玩家是否升级，并输出相关信息。

2. **解析时间字符串**：
    - `Main.parseTimeToHours(timeString)`：
        - 解析时间字符串为小时数。
        - 具体步骤：
            - 使用正则表达式匹配时间字符串中的天、时、分、秒。
            - 计算总时间（小时数）。

### 4. 总结
通过以上步骤，项目实现了从数据加载到结果输出的完整流程。具体流程如下：

1. **数据加载和解析**：
    - 检查文件是否存在，如果不存在则从网络获取数据并存储到文件中。
    - 如果文件存在，则从文件中读取已保存的数据并解析为`Map`对象返回。
    - 解析数据，将数据组织成嵌套的映射结构，并存储到文件中。

2. **初始化游戏数据**：
    - 根据数据内容将数据分类存储到`researchMap`和`buildingMap`中。
    - 处理等级和数量数据。
    - 保存和加载配置。

3. **计算升级收益**：
    - 遍历每个建筑，计算每个建筑的升级收益。
    - 对结果列表按照收益比降序排序。
    - 计算累计经验和总时间，输出结果。
    - 根据累计经验判断玩家是否升级，并输出相关信息。

通过这些步骤，项目能够有效地加载和解析游戏数据，计算每个建筑的升级收益，并输出排序后的结果。